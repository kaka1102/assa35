

<link href="~/Content/plugins/bower_components/gallery/css/animated-masonry-gallery.css" rel="stylesheet" />
<link href="~/Content/plugins/bower_components/fancybox/ekko-lightbox.min.css" rel="stylesheet" />
<style type="text/css">
    .modal-lg {
        max-width: 80%;
    }
</style>


<div class="row">
    <div class="col-sm-12">
        <div class="white-box p-l-20 p-r-20">
            <div class="col-sm-12" style="padding-bottom: 10px; border-bottom: 1px solid red;">
                <div class="row">
                    <div class="col-sm-6" style="float:left">
                        <h3 class="box-title m-b-0"><i class="ti-angle-double-right" style="padding-right:10px"></i>@(ASS_35.Resources.HomeText.EditSpeaker)</h3>
                    </div>
                    <div class="col-sm-6" style="float:right">
                        <h3 class="box-title m-b-0" style="float:right"><i class="ti-arrow-left" style="padding-right:10px"></i><a href="javascript:0" id="btnBack">@(ASS_35.Resources.HomeText.ButtonBack)</a></h3>
                    </div>
                </div>
            </div>
            <div class="row" style="padding-top:20px">
                <div class="col-md-12">
                    <form class="form-material form-horizontal" id="formAddNew">
                        <div class="form-group">
                            <label class="col-md-12">@(ASS_35.Resources.HomeText.Full_Name) <i class="requite-icon">(*)</i></label>
                            <div class="col-md-12">
                                <input type="text" class="form-control form-control-line" id="hoten">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-md-12">@(ASS_35.Resources.HomeText.Position)  </label>
                            <div class="col-md-12">
                                <textarea class="form-control" rows="5" id="chucvu"></textarea>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-md-12">@(ASS_35.Resources.HomeText.Introduce)  <i class="requite-icon">(*)</i></label>
                        </div>
                        <div class="form-group">
                            <textarea name="noidung" id="noidung" rows="10" cols="80"></textarea>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-12">@(ASS_35.Resources.HomeText.Location)</label>
                            <div class="col-sm-12">
                                <select class="form-control" id="phienban">
                                    <option value="GUESTSPEAKER">@(ASS_35.Resources.HomeText.GUESTSPEAKER)</option>
                                    <option value="KEYNOTESPEAKER">@(ASS_35.Resources.HomeText.KEYNOTESPEAKER)</option>
                                    <option value="PANELIST">@(ASS_35.Resources.HomeText.PANELIST)</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-12">@(ASS_35.Resources.HomeText.Avatar)</label>
                            <div class="galleryView">
                                <div id="galleryViewContent">
                                    <div id="galleryView-content-center" style="margin-top:10px" class="galleryView-content gallery-content-center-full isotope">

                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-12">@(ASS_35.Resources.HomeText.Avatar) <i class="requite-icon">(*)</i></label>
                            <div class="col-sm-6">
                                <div class="fileinput fileinput-new input-group" id="item-append-error">
                                    <div class="form-control" id="frmInput">
                                        <i class="glyphicon glyphicon-file"></i>@(ASS_35.Resources.HomeText.Leng_File_Chose)
                                    </div>
                                    <span class="input-group-addon btn btn-default btn-file">
                                        <span class="fileinput-new">@(ASS_35.Resources.HomeText.Select_file)</span>
                                        <input type="hidden"><input type="file" name="..." id="btnInputSingle" accept="image/x-png,image/gif,image/jpeg">
                                    </span>
                                    <span id="appendInput">

                                    </span>
                                </div>
                            </div>
                            <div id="gallery" class="">
                                <div id="gallery-content">
                                    <div id="gallery-content-center" class="gallery-content-center-full isotope">

                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-12">@(ASS_35.Resources.HomeText.Summaryfile)</label>
                            <div class="galleryView">
                                <div id="galleryViewContent">
                                    <ul class="feeds" id="view-file-db1"></ul>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-12">@(ASS_35.Resources.HomeText.Abstract) </label>
                            <div class="col-sm-6">
                                <div class="fileinput fileinput-new input-group" id="item-append-error">
                                    <div class="form-control" id="frmInput1">
                                        <i class="glyphicon glyphicon-file"></i> @(ASS_35.Resources.HomeText.Leng_File_Chose)
                                    </div>
                                    <span class="input-group-addon btn btn-default btn-file">
                                        <span class="fileinput-new">@(ASS_35.Resources.HomeText.Select_file)</span>
                                        <input type="hidden"><input type="file" name="..." id="btnInputFile1" accept="application/pdf">
                                    </span>
                                    <span id="appendInput">

                                    </span>
                                </div>
                            </div>
                            <div id="gallaryFileOther">
                                <ul class="feeds" id="view-item-file1"></ul>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-12">@(ASS_35.Resources.HomeText.Presentationskills)</label>
                            <div class="galleryView">
                                <div id="galleryViewContent">
                                    <ul class="feeds" id="view-file-db2"></ul>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-12">@(ASS_35.Resources.HomeText.Presentation) </label>
                            <div class="col-sm-6">
                                <div class="fileinput fileinput-new input-group" id="item-append-error">
                                    <div class="form-control" id="frmInput2">
                                        <i class="glyphicon glyphicon-file"></i> @(ASS_35.Resources.HomeText.Leng_File_Chose)
                                    </div>
                                    <span class="input-group-addon btn btn-default btn-file">
                                        <span class="fileinput-new">@(ASS_35.Resources.HomeText.Select_file)</span>
                                        <input type="hidden"><input type="file" name="..." id="btnInputFile2" accept="application/pdf">
                                    </span>
                                    <span id="appendInput">

                                    </span>
                                </div>
                            </div>
                            <div id="gallaryFileOther">
                                <ul class="feeds" id="view-item-file2"></ul>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-12">@(ASS_35.Resources.HomeText.Status)</label>
                            <div class="col-sm-12">
                                <select class="form-control" id="trangthai" disabled>
                                    <option disabled value="3">@(ASS_35.Resources.HomeText.Active)</option>
                                    <option disabled value="4">@(ASS_35.Resources.HomeText.Save_Draft)</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button class="btn btn-success waves-effect waves-light" type="button" id="btnSave">
                                <span class="btn-label"><i class="ti-save"></i></span>@(ASS_35.Resources.HomeText.Save_Draft)
                            </button>
                            <button class="btn btn-primary waves-effect waves-light" data-item="3" type="button" id="btnSaveandPost">
                                <span class="btn-label"><i class="ti-save"></i></span>@(ASS_35.Resources.HomeText.SaveAndPost)
                            </button>
                        </div>
                    </form>
                </div>
            </div>

        </div>
    </div>
</div>
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" style="display: none;" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title" id="myLargeModalLabel"></h4>
            </div>
            <div class="modal-body" style="min-height:500px">

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger waves-effect text-left" data-dismiss="modal">@(ASS_35.Resources.HomeText.Close)</button>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    CKEDITOR.replace('noidung',
               {
                   fullPage: false,
                   imageBrowser_listUrl: "~/Content/plugins/bower_components/ckeditor/plugins/imagebrowser/browser/browser.html",
                   filebrowserVideoBrowseUrl: "/Content/plugins/bower_components/ckeditor/plugins/video/Servervideo.html",
               });
</script>

<script src="~/Content/eliteadmin-colors/js/input-file-show.js"></script>
<script src="~/Content/plugins/bower_components/fancybox/ekko-lightbox.min.js"></script>
<script src="~/Content/ScriptPuplic/LibAss.js"></script>
<script type="text/javascript">
    var lstDel = [];
    var btnSave = document.getElementById("btnSave");
    var btnSaveandPost = document.getElementById("btnSaveandPost");


    var btnInput = document.getElementById("btnInput");

    var hoten = document.getElementById("hoten");
    var chucvu = document.getElementById("chucvu");
    var noidung = document.getElementById("noidung");
    var phienban = document.getElementById("phienban");
    var trangthai = document.getElementById("trangthai");

    $(function () {
        var userInfo = JSON.parse(@Html.Raw(ViewBag.data));
        BindValueToControl(userInfo);

        BindUrlBackEditForm("/Speaker/Index", "btnBack");

        $('#btnSave').click(function () {
            UpdateLibraryDocument(userInfo.id);
        });

        $('#btnSaveandPost').click(function () {
            UpdateLibraryDocumentAndPost(userInfo.id);
        });
    });

    function BindValueToControl(data) {

        $('#hoten').val(data.hoten);
        $('#chucvu').val(data.chucvu);
        $('#noidung').val(data.noidung);
        $('#phienban').val(data.kieu);
        $('#trangthai').val(data.trangthai);

        RenderImages(data.avatar);

        if (data.file_abstract != "" && data.file_abstract != null) {
            RenderDocument1(data.file_abstract);
        } else {
            $('#view-file-db1').append("<label class='col-sm-12'>Chưa có file</label>");
        }
        if (data.presentation != "" && data.presentation != null) {
            RenderDocument2(data.presentation);
        } else {
            $('#view-file-db2').append("<label class='col-sm-12'>Chưa có file</label>");
        }

        hoten.addEventListener("keyup", function (e) {
            e.preventDefault();
            QTW_VALIDATION.CheckFiled_Requite(hoten, "", 3, 500);
        });
        chucvu.addEventListener("keyup", function (e) {
            e.preventDefault();
            QTW_VALIDATION.CheckField_NNonRequite(chucvu, "", 3);
        });
    }

    function UpdateLibraryDocument(id) {

        var validate = true;

        if (!QTW_VALIDATION.CheckFiled_Requite(hoten, "", 3, 500))
            validate = false;
        if (!QTW_VALIDATION.CheckField_NNonRequite(chucvu, "", 3))
            validate = false;

        if (validate) {

            var fm_data = new FormData();
            var dataObject = {
                id: id,
                hoten: hoten.value,
                chucvu: chucvu.value,
                phienban: phienban.value,
                trangthai: 4,
                noidung: CKEDITOR.instances['noidung'].getData(),
            };
            var lstFile1 = [];
            var button1 = $('#view-item-file1').find('button');
            $.each(button1, function (i, v) {
                lstFile1.push($(this).attr("data-id"));
            });

            var lstFile2 = [];
            var button2 = $('#view-item-file2').find('button');
            $.each(button2, function (i, v) {
                lstFile2.push($(this).attr("data-id"));
            });


            fm_data.append("DataSend", JSON.stringify(dataObject));
            fm_data.append("lstFile", $('#btnInputSingle')[0].files[0]);
            fm_data.append("lstFile1", JSON.stringify(lstFile1));
            fm_data.append("lstFile2", JSON.stringify(lstFile2));

            var success = function (dx) {
                if (dx.Result.IsSuccess) {
                    QTW_RUN_MESS.alter_Message_Success(dx.Result.Message);
                }
                else {
                    QTW_RUN_MESS.alter_Message_Error(dx.Result.Message);
                }
            }
            var fun = function () {
                QTW_JQUERY.RUN_AJAX("ajaxPOST", "/Speaker/_UpdateSpeaker", fm_data, success);
            }
            QTW_RUN_MESS.alter_Message_Question_Callbaclk(" @Html.Raw(ASS_35.Resources.HomeText.Update_infor) ", fun);

        } else {
            console.log(0000000000000000);
        }

    }

    function UpdateLibraryDocumentAndPost(id) {

        var validate = true;

        if (!QTW_VALIDATION.CheckFiled_Requite(hoten, "", 3, 500))
            validate = false;
        if (!QTW_VALIDATION.CheckField_NNonRequite(chucvu, "", 3))
            validate = false;

        if (validate) {

            var fm_data = new FormData();
            var dataObject = {
                id: id,
                hoten: hoten.value,
                chucvu: chucvu.value,
                phienban: phienban.value,
                trangthai: 3,
                noidung: CKEDITOR.instances['noidung'].getData(),
            };
            var lstFile1 = [];
            var button1 = $('#view-item-file1').find('button');
            $.each(button1, function (i, v) {
                lstFile1.push($(this).attr("data-id"));
            });

            var lstFile2 = [];
            var button2 = $('#view-item-file2').find('button');
            $.each(button2, function (i, v) {
                lstFile2.push($(this).attr("data-id"));
            });


            fm_data.append("DataSend", JSON.stringify(dataObject));
            fm_data.append("lstFile", $('#btnInputSingle')[0].files[0]);
            fm_data.append("lstFile1", JSON.stringify(lstFile1));
            fm_data.append("lstFile2", JSON.stringify(lstFile2));

            var success = function (dx) {
                if (dx.Result.IsSuccess) {
                    QTW_RUN_MESS.alter_Message_Success(dx.Result.Message);
                }
                else {
                    QTW_RUN_MESS.alter_Message_Error(dx.Result.Message);
                }
            }
            var fun = function () {
                QTW_JQUERY.RUN_AJAX("ajaxPOST", "/Speaker/_UpdateSpeaker", fm_data, success);
            }
            QTW_RUN_MESS.alter_Message_Question_Callbaclk(" @Html.Raw(ASS_35.Resources.HomeText.Update_infor) ", fun);

        } else {
            console.log(0000000000000000);
        }
    }

    function RenderDocument1(file) {
        var icon = "fa fa-file-pdf-o";
        $('#view-file-db1').append("<li  style='position: relative;'>\
                                       <div style='width: 90%;' data-toggle='modal' data-target='.bs-example-modal-lg'  data-url='" + file + "' class='li-item-file li-file model_img img-responsive'>\
                                            <div class='bg-purple' style='width: 40px;float: left;'>\
                                                 <i class='"+ icon + " text-white'></i>\
                                            </div>\
                                            <div style='float: left;padding: 10px;width: 70%;'>\
                                                <span style='float:left'>Click here show file pdf</span>\
                                            </div>\
                                       </div>\
                                 </li>");
        $('.li-item-file').unbind();
        $('.li-item-file').click(function () {
            var url = $(this).attr('data-url')
            $('.modal-body').empty();
            $('#myLargeModalLabel').text('');
            $('.modal-body').append("<embed src='/Media/ReadFilePDF?url=" + url + "' style='min-height: 500px; width: 100%;' />");
        });
    }

    function RenderDocument2(file) {
        var icon = "fa fa-file-pdf-o";
        $('#view-file-db2').append("<li  style='position: relative;'>\
                                       <div style='width: 90%;' data-toggle='modal' data-target='.bs-example-modal-lg'  data-url='" + file + "' class='li-item-file li-file model_img img-responsive'>\
                                            <div class='bg-purple' style='width: 40px;float: left;'>\
                                                 <i class='"+ icon + " text-white'></i>\
                                            </div>\
                                            <div style='float: left;padding: 10px;width: 70%;'>\
                                                <span style='float:left'>Click here show file pdf</span>\
                                            </div>\
                                       </div>\
                                 </li>");
        $('.li-item-file').unbind();
        $('.li-item-file').click(function () {
            var url = $(this).attr('data-url')
            $('.modal-body').empty();
            $('#myLargeModalLabel').text('');
            $('.modal-body').append("<embed src='/Media/ReadFilePDF?url=" + url + "' style='min-height: 500px; width: 100%;' />");
        });
    }

    function RenderImages(file) {
        var span = document.createElement("span");
        var link = document.createElement("a");
        var preview = document.createElement("img");
        span.appendChild(preview);
        span.setAttribute("style", "height: 100%;float: left;position: relative;")
        preview.setAttribute("src", file);
        preview.setAttribute("class", "all studio isotope-item");
        preview.setAttribute("data-toggle", "lightbox");
        preview.setAttribute("data-gallery", "multiimages");
        preview.setAttribute("href", file);

        $('#galleryView-content-center').append(span);
    }

</script>